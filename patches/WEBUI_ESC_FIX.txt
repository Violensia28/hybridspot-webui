
// REPLACE your existing 'esc' function with this safe implementation
static String esc(const String& s){
  String o; o.reserve(s.length()+8);
  for (size_t i=0;i<s.length();++i){
    char c = s.charAt(i);
    if (c == '"')      o += "\\\"";   // quote -> \"
    else if (c == '\\') o += "\\\\";   // backslash -> \\
    else if (c == '\n') o += "\\n";    // newline -> \n
    else                o += c;
  }
  return o;
}
